(()=>{var e={};e.id=518,e.ids=[518],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},10264:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>h,routeModule:()=>p,serverHooks:()=>d,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>m});var a={};t.r(a),t.d(a,{POST:()=>c});var s=t(42706),n=t(28203),o=t(45994),i=t(39187),u=t(57886);async function c(e){try{let r=await e.json();if(!r.firstName||!r.lastName||!r.email||!r.phone)return i.NextResponse.json({error:"Missing required fields",required:["firstName","lastName","email","phone"]},{status:400});let t={firstName:r.firstName.trim(),lastName:r.lastName.trim(),email:r.email.toLowerCase().trim(),phone:r.phone.replace(/\D/g,""),countryCode:r.countryCode||"+1",trafficSource:"unknown",landingPage:"",utmCampaign:null,utmSource:null,utmMedium:null},a=(0,u.AG)(),{data:s,error:n}=await a.from("pre_checkout").insert({first_name:t.firstName,last_name:t.lastName,email:t.email,phone:t.phone,country_code:t.countryCode,traffic_source:t.trafficSource,landing_page:t.landingPage,utm_campaign:t.utmCampaign,utm_source:t.utmSource,utm_medium:t.utmMedium}).select().single();if(n){if(console.error("❌ Error saving pre-checkout:",n),"23505"===n.code)return i.NextResponse.json({success:!0,message:"Email already registered",duplicate:!0},{status:200});return i.NextResponse.json({error:"Failed to save lead",details:n.message},{status:500})}if(console.log("✅ Pre-checkout saved:",{id:s.id,email:s.email,source:s.traffic_source,landing:s.landing_page}),process.env.META_PIXEL_ID)try{await fetch(`https://graph.facebook.com/v18.0/${process.env.META_PIXEL_ID}/events`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:[{event_name:"Lead",event_time:Math.floor(Date.now()/1e3),user_data:{em:r.email.toLowerCase().trim(),ph:r.phone.replace(/\D/g,"")},custom_data:{content_name:"Landing Form Submit",value:0,currency:"USD"}}],access_token:process.env.META_PIXEL_ACCESS_TOKEN})})}catch(e){console.warn("⚠️ Meta Pixel tracking failed:",e)}return i.NextResponse.json({success:!0,leadId:s.id,message:"Lead captured successfully"},{status:201})}catch(e){return console.error("❌ Pre-checkout API error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/pre-checkout/route",pathname:"/api/pre-checkout",filename:"route",bundlePath:"app/api/pre-checkout/route"},resolvedPagePath:"/home/runner/work/MVP-SaludCompartida/MVP-SaludCompartida/src/app/api/pre-checkout/route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:l,workUnitAsyncStorage:m,serverHooks:d}=p;function h(){return(0,o.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:m})}},96487:()=>{},78335:()=>{},57886:(e,r,t)=>{"use strict";t.d(r,{AG:()=>n,yg:()=>o});var a=t(47752);let s=null;function n(){if(s)return s;let e=process.env.SUPABASE_URL||"https://rzmdekjegbdgitqekjee.supabase.co",r=process.env.SUPABASE_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ6bWRla2plZ2JkZ2l0cWVramVlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzY0NTQ2NDcsImV4cCI6MjA1MjAzMDY0N30.pPTn8F7vK0xQYq8YvH5FvXJaHZ0xF7UwJ4qJ5xKqHzQ";if(!e||!r)throw Error("Missing Supabase environment variables");return s=(0,a.UU)(e,r,{auth:{autoRefreshToken:!1,persistSession:!1}})}function o(){let e="ABCDEFGHJKLMNPQRSTUVWXYZ23456789",r="SC-";for(let t=0;t<6;t++)r+=e.charAt(Math.floor(Math.random()*e.length));return r}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[638,452,752],()=>t(10264));module.exports=a})();