"use strict";(()=>{var e={};e.id=63,e.ids=[63],e.modules={10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},77598:e=>{e.exports=require("node:crypto")},20835:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>x,routeModule:()=>d,serverHooks:()=>g,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>m});var a={};t.r(a),t.d(a,{GET:()=>u});var n=t(42706),o=t(28203),s=t(45994),i=t(39187),c=t(57886),p=t(12015);async function u(e){try{let r=e.headers.get("authorization"),t=process.env.CRON_SECRET||"dev-secret-change-in-production";if(r!==`Bearer ${t}`)return i.NextResponse.json({error:"Unauthorized"},{status:401});let a=(0,c.AG)(),{count:n}=await a.from("registrations").select("*",{count:"exact",head:!0}),{count:o}=await a.from("registrations").select("*",{count:"exact",head:!0}).eq("status","active"),s=new Date;s.setHours(0,0,0,0);let{count:u}=await a.from("registrations").select("*",{count:"exact",head:!0}).gte("created_at",s.toISOString()),d=new Date;d.setDate(d.getDate()-1);let{data:l}=await a.from("registrations").select("codigo_familia, migrant_name, principal_name, principal_phone, plan_name, created_at").gte("created_at",d.toISOString()).order("created_at",{ascending:!1}).limit(50),m=await (0,p.Do)({totalSubscribers:n||0,newToday:u||0,activeSubscriptions:o||0,recentSubscriptions:(l||[]).map(e=>({codigoFamilia:e.codigo_familia,migrantName:e.migrant_name,principalName:e.principal_name,principalPhone:e.principal_phone,planName:e.plan_name,createdAt:new Date(e.created_at).toLocaleString("es-MX")}))});return i.NextResponse.json({success:m.success,stats:{totalSubscribers:n,newToday:u,activeSubscriptions:o,recentCount:l?.length||0},timestamp:new Date().toISOString()})}catch(e){return console.error("Daily summary error:",e),i.NextResponse.json({error:"Error al generar resumen diario",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}let d=new n.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/cron/daily-summary/route",pathname:"/api/cron/daily-summary",filename:"route",bundlePath:"app/api/cron/daily-summary/route"},resolvedPagePath:"/home/runner/work/MVP-SaludCompartida/MVP-SaludCompartida/src/app/api/cron/daily-summary/route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:l,workUnitAsyncStorage:m,serverHooks:g}=d;function x(){return(0,s.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:m})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[638,452,752,691,744],()=>t(20835));module.exports=a})();